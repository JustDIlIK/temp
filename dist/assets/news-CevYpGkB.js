import{b as M,f as m,B as A,C as B,D as C,o as n,c as d,a as i,h as _,w as s,T as I,i as v,y as u,t as f,F as N,l as P,m as L,k as b,E as S}from"./index-CHCyrYkC.js";import{u as V}from"./news-D6qCfLGh.js";/* empty css             */import{T as $}from"./TheTitle-ByJGnlYA.js";import{_ as F}from"./card.vue_vue_type_script_setup_true_lang-C7y8YrLl.js";import{g as U}from"./hooks-CHDj8uky.js";import"./axios-rFEYxPUp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"container mx-auto px-4"},E={class:"mb-4"},H=["src"],O=["innerHTML"],z={key:0,class:"text-center mt-4"},Z=M({__name:"news",setup(G){const a=V(),g=m(1),l=m(!1),p=m(null),w=async(r=!1)=>{if(l.value||!a.hasMoreData)return;l.value=!0;let t=r?1:g.value;console.log(`Загрузка страницы: ${t}`);try{await a.loadAllNews({page:g.value,limit:a.itemPerPage}),a.news.length>0?(a.news.filter(x=>!a.newsArray.some(c=>c.id===x.id)).length>0&&(a.newsArray.push(...a.news),g.value++),a.news.length<a.itemPerPage&&(a.hasMoreData=!1)):a.hasMoreData=!1}catch(e){console.error("Ошибка при загрузке скидок:",e)}finally{l.value=!1}};let o=null;const k=()=>{o&&o.disconnect(),p.value&&(o=new IntersectionObserver(r=>{r[0].isIntersecting&&a.hasMoreData&&(console.log("Наблюдатель сработал! Загружаем новую страницу..."),w())},{rootMargin:"100px",threshold:.1}),o.observe(p.value))};A(()=>{a.newsArray=[],a.hasMoreData=!0}),B(async()=>{a.newsArray.length===0&&await w(!0),C(()=>k())});const D=r=>r.length>100?"bg-gradient-to-b from-black to-white bg-clip-text text-transparent font-oregular text-[16px]":"text-black font-oregular text-[16px]",T=r=>{if(!r)return"";const t=new Date(r);return new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"long",year:"numeric"}).format(t)},y=r=>{if(!r)return"";const t=r.replace(/<(?!p\s|\/p)[^>]+>/gi,"").replace(/&nbsp;/g,"").trim();return t.length>0?t:""};return(r,t)=>(n(),d("div",j,[i("div",E,[_($,null,{default:s(()=>[u(f(r.$t("Новости")),1)]),_:1})]),_(I,{name:"fade",tag:"div",class:"grid grid-cols-4 max-xl:grid-cols-3 max-lg:grid-cols-2 max-sm:grid-cols-1 max-sm:mx-auto max-sm:w-9/12 max[425px]:w-11/12 max-sm:justify-center gap-[30px] break-words"},{default:s(()=>[(n(!0),d(N,null,P(b(a).newsArray,(e,x)=>(n(),L(F,{key:e.id,"card-image-flag":!0,style:S({transitionDelay:x*.1+"s"}),"card-percent-flag":!1,"price-container-flag":!1,"card-description-flag":!0,"card-btn-flag":!0,"card-title-flag":!0,"card-discount-flag":!1,"card-price-flag":!1,"card-date-flag":!0,"card-date-style":"mt-[16px] text-oregular text-[15px]","card-block-style":"justify-center  items-center rounded-xl","card-link-text":"news","card-description-style":D(e.content),"card-title-style":"text-[22px] text-to mt-6 !font-omedium","card-image-style":"mx-auto !w-full","card-link":e==null?void 0:e.id},{cardImage:s(()=>[i("img",{class:"!rounded-lg !w-full",src:b(U)+e.image_url,alt:"news-image"},null,8,H)]),cardTitle:s(()=>{var c,h;return[u(f(((c=e==null?void 0:e.title)==null?void 0:c.length)>30?((h=e==null?void 0:e.title)==null?void 0:h.slice(0,30))+"...":e==null?void 0:e.title),1)]}),cardDescription:s(()=>[y(e==null?void 0:e.content)?(n(),d("span",{key:0,innerHTML:y(e==null?void 0:e.content)},null,8,O)):v("",!0)]),cardBtn:s(()=>[u(f(r.$t("Читать полностью")),1)]),cardDate:s(()=>[u(f(T(e==null?void 0:e.created_at)),1)]),_:2},1032,["style","card-description-style","card-link"]))),128))]),_:1}),i("div",{ref_key:"observerTarget",ref:p,class:"h-10"},null,512),l.value?(n(),d("div",z,t[0]||(t[0]=[i("p",null,"Загрузка...",-1)]))):v("",!0)]))}});export{Z as default};
