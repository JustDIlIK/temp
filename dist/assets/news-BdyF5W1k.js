import{b as A,g as y,E as B,G as I,H as N,o as n,c as u,a as d,i as v,w as s,T as P,k,B as i,t as g,F as S,q as C,s as L,p as f,j as V}from"./index-D4Mu-t5E.js";import{u as $}from"./news-D7usFuCA.js";/* empty css             */import{T as j}from"./TheTitle-CUokdGfA.js";import{_ as z}from"./card.vue_vue_type_script_setup_true_lang-B9R_qs-O.js";import{g as F}from"./hooks-RYPYS_tH.js";import{u as G}from"./global-DPbk4Bjp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"container mx-auto px-4"},U={class:"mb-4"},E=["src"],O=["innerHTML"],q={key:0,class:"text-center mt-4"},ae=A({__name:"news",setup(R){const a=$(),p=y(1),l=y(!1),x=y(null),_=G(),h=async(r=!1)=>{if(l.value||!a.hasMoreData)return;l.value=!0;let t=r?1:p.value;console.log(`Загрузка страницы: ${t}`);try{await a.loadAllNews({page:p.value,limit:a.itemPerPage}),a.news.length>0?(a.news.filter(w=>!a.newsArray.some(c=>c.id===w.id)).length>0&&(a.newsArray.push(...a.news),p.value++),a.news.length<a.itemPerPage&&(a.hasMoreData=!1)):a.hasMoreData=!1}catch(e){console.error("Ошибка при загрузке скидок:",e)}finally{l.value=!1}};let o=null;const D=()=>{o&&o.disconnect(),x.value&&(o=new IntersectionObserver(r=>{r[0].isIntersecting&&a.hasMoreData&&(console.log("Наблюдатель сработал! Загружаем новую страницу..."),h())},{rootMargin:"100px",threshold:.1}),o.observe(x.value))};B(()=>{a.newsArray=[],a.hasMoreData=!0}),I(async()=>{a.newsArray.length===0&&await h(!0),N(()=>D())});const T=r=>r.length>100?"bg-gradient-to-b from-black to-white bg-clip-text text-transparent font-oregular text-[16px]":"text-black font-oregular text-[16px]",M=r=>{if(!r)return"";const t=new Date(r);return new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"long",year:"numeric"}).format(t)},m=r=>{if(!r)return"";const t=r.replace(/<(?!p\s|\/p)[^>]+>/gi,"").replace(/&nbsp;/g,"").trim().slice(0,291);return t.length>0?t:""};return(r,t)=>(n(),u("div",H,[d("div",U,[v(j,null,{default:s(()=>[i(g(r.$t("Новости")),1)]),_:1})]),v(P,{name:"fade",tag:"div",class:"grid grid-cols-4 max-xl:grid-cols-3 max-lg:grid-cols-2 max-sm:grid-cols-1 max-sm:mx-auto max-sm:w-9/12 max[425px]:w-11/12 max-sm:justify-center gap-[30px] break-words"},{default:s(()=>[(n(!0),u(S,null,C(f(a).newsArray,(e,w)=>(n(),L(z,{key:e.id,"card-image-flag":!0,style:V({transitionDelay:w*.1+"s"}),"card-percent-flag":!1,"price-container-flag":!1,"card-description-flag":!0,"card-btn-flag":!0,"card-title-flag":!0,"card-discount-flag":!1,"card-price-flag":!1,"card-date-flag":!0,"card-date-style":"mt-[16px] text-oregular text-[15px]","card-block-style":"justify-center  items-center rounded-xl","card-link-text":"news","card-description-style":T(e.content),"card-title-style":"text-[22px] text-to mt-6 !font-omedium","card-image-style":"mx-auto !w-full","card-link":e==null?void 0:e.id},{cardImage:s(()=>[d("img",{class:"!rounded-lg !w-full",src:f(F)+e.image_url,alt:"news-image"},null,8,E)]),cardTitle:s(()=>{var c,b;return[i(g(f(_).language!=="ru"?((c=e==null?void 0:e.title_uz)==null?void 0:c.slice(0,30))+"...":(b=e==null?void 0:e.title)==null?void 0:b.slice(0,30)),1)]}),cardDescription:s(()=>[m(e==null?void 0:e.content)?(n(),u("span",{key:0,innerHTML:f(_).language!=="ru"?m(e==null?void 0:e.content_uz):m(e==null?void 0:e.content)},null,8,O)):k("",!0)]),cardBtn:s(()=>[i(g(r.$t("Читать полностью")),1)]),cardDate:s(()=>[i(g(M(e==null?void 0:e.created_at)),1)]),_:2},1032,["style","card-description-style","card-link"]))),128))]),_:1}),d("div",{ref_key:"observerTarget",ref:x,class:"h-10"},null,512),l.value?(n(),u("div",q,t[0]||(t[0]=[d("p",null,"Загрузка...",-1)]))):k("",!0)]))}});export{ae as default};
