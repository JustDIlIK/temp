import{b as S,E as P,g as d,H as I,I as L,o as p,c as h,a as s,i as T,w as c,t as f,T as B,k as $,B as m,F as H,q as N,s as j,p as g,j as z}from"./index-CE6KkOkP.js";/* empty css             */import{T as C}from"./TheTitle-4UUuzE64.js";import{_ as F}from"./card.vue_vue_type_script_setup_true_lang-B7Efqek7.js";import{u as V}from"./products-BH5lrXs_.js";import{g as q}from"./hooks-RYPYS_tH.js";import{u as E}from"./global-BsgjTX97.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"container mx-auto"},O={class:"max-md:mx-4"},R=["src"],U=["innerHTML"],W={class:"price-container relative"},A=["innerHTML"],J={key:0,class:"text-center mt-4"},se=S({__name:"discounts",setup(K){const l=V(),D=P("el"),_=d(4),b=d(1),i=d(!1),x=d(null),v=E(),w=o=>{if(!o)return"";let r=o.toLocaleString();const[e,n]=r.split(".");if(e.length<=3)return r;const a=e.slice(0,-3),t=e.slice(-3);let k=`${a}<sup>${t}</sup>`;return n&&(k+=`.${n}`),k},y=async(o=!1)=>{if(i.value||!l.hasMoreData)return;i.value=!0;let r=o?1:b.value+1;try{for(;;){if(await l.loadProducts({page:r,limit:_.value}),l.products.length===0){l.hasMoreData=!1;break}const e=l.products.flatMap(()=>l.products.map(t=>t?{...t}:null)).filter(Boolean),n=new Set(l.newData.map(t=>t.id)),a=e.filter(t=>n.has(t.id)?!1:(n.add(t.id),!0));if(a.length&&(l.newData.push(...a),b.value=r),a.length<_.value)break;r++}}catch(e){console.error(e)}finally{i.value=!1}};let u=null;const M=()=>{u&&u.disconnect(),x.value&&(u=new IntersectionObserver(o=>{o[0].isIntersecting&&l.hasMoreData&&!i.value&&y()},{rootMargin:"100px",threshold:.1}),u.observe(x.value))};return I(async()=>{await y(!0),L(()=>M())}),(o,r)=>(p(),h("div",G,[s("div",O,[T(C,null,{default:c(()=>[m(f(o.$t("Каталог скидок")),1)]),_:1}),s("p",null,f(o.$t("Ищите ценники с желтым цветом!")),1)]),s("div",{ref_key:"el",ref:D},[T(B,{name:"fade",tag:"div",class:"grid grid-cols-4 gap-y-4 max-md:flex max-md:flex-col max-2xl:grid-cols-3 max-xl:grid-cols-2 max-md:grid-cols-1 max-xl:mx-auto justify-center items-center gap-x-10 break-all"},{default:c(()=>[(p(!0),h(H,null,N(g(l).newData,(e,n)=>(p(),j(F,{key:e.id,style:z({transitionDelay:n*.07+"s"}),"card-image-flag":!0,"card-percent-flag":!0,"price-container-flag":!0,"card-description-flag":!0,"card-title-flag":!0,"card-discount-flag":!0,"card-price-flag":!0,"card-block-style":"w-[326px] h-[440px] flex flex-col justify-center items-center mx-2 bg-white shadow-blockShadow p-7 mb-10 mt-10 rounded-xl","card-link-text":"product","card-price-design-container":"absolute top-40 -right-10 text-white","card-discount-style":"text-2xl w-full z-20 font-obold flex justify-center top-6 left-1","card-price-style":"text-[16px] font-oregular flex","card-price-and-percent":"flex gap-x-2 items-center pl-4 absolute bottom-0 right-0 w-full","card-percent-style":"text-[14px] font-obold text-black bg-[#FFC600] py-3 px-1 rounded-tl-xl rounded-br-[20px] rounded-bl-md rounded-tr-md -right-1 absolute [clip-path:polygon(33%_0,100%_0,100%_70%,68%_100%,0_100%,0%_39%)]","card-title-style":"text-[22px] !break-normal mt-10 !font-omedium","card-image-style":"mx-auto h-[250px] flex items-center w-max relative rounded-full","card-link":e==null?void 0:e.id},{cardImage:c(()=>[s("img",{class:"rounded-lg w-[200px] mx-auto",src:g(q)+(e==null?void 0:e.image_url),alt:""},null,8,R)]),cardTitle:c(()=>{var a,t;return[m(f(g(v).language!=="ru"?((a=e==null?void 0:e.title_uz)==null?void 0:a.slice(0,30))+"...":(t=e==null?void 0:e.title)==null?void 0:t.slice(0,30)),1)]}),cardDescription:c(()=>{var a,t;return[m(f(g(v).language!=="ru"?((a=e==null?void 0:e.description_uz)==null?void 0:a.slice(0,30))+"...":(t=e==null?void 0:e.description)==null?void 0:t.slice(0,30)),1)]}),cardDiscount:c(()=>[s("span",{innerHTML:w(e==null?void 0:e.new_price)},null,8,U)]),cardPrice:c(()=>[s("div",W,[s("span",{class:"price-text",innerHTML:w(e.price)},null,8,A),r[0]||(r[0]=s("svg",{class:"price-strike absolute -bottom-1.5 -left-1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 20",width:"110%",height:"40"},[s("line",{x1:"100",y1:"0",x2:"0",y2:"25",stroke:"white","stroke-width":"2"})],-1))])]),_:2},1032,["style","card-link"]))),128))]),_:1})],512),s("div",{ref_key:"observerTarget",ref:x,class:"h-10"},null,512),i.value?(p(),h("div",J,r[1]||(r[1]=[s("p",null,"Загрузка...",-1)]))):$("",!0)]))}});export{se as default};
