import{b as _,E as w,g as f,G as b,H as S,I as M,x as P,o as n,c,a as u,i as v,w as d,T,k as A,F as D,q as I,j as B,p,B as N,t as V}from"./index-acZ7sPOD.js";import{u as G}from"./stocks-DMirEH0e.js";import{_ as z}from"./card.vue_vue_type_script_setup_true_lang-9eEu4yVs.js";import{g as E}from"./hooks-RYPYS_tH.js";import{u as F}from"./global-DhIFhe14.js";const L={class:"container mx-auto"},O=["src"],U={key:0,class:"text-center mt-4"},K=_({__name:"stocks",setup($){const y=w("el"),a=f(1),t=f(!1),i=f(null),k=F(),e=G(),x=async(o=!1)=>{if(t.value||!e.hasMoreData)return;t.value=!0;let r=o?1:a.value+1;console.log(`Загрузка страницы: ${r}`);try{await e.loadAllStocks({page:a.value,limit:e.itemPerPage}),e.stocks.length>0?(e.stocks.filter(g=>!e.stocksArray.some(m=>m.id===g.id)).length>0&&(e.stocksArray.push(...e.stocks),a.value++),e.stocks.length<e.itemPerPage&&(console.log("Меньше товаров, чем лимит, останавливаем дальнейшую загрузку."),e.hasMoreData=!1)):e.hasMoreData=!1}catch(s){console.error("Ошибка при загрузке скидок:",s)}finally{t.value=!1}};let l=null;const h=()=>{l&&l.disconnect(),i.value&&(l=new IntersectionObserver(o=>{o[0].isIntersecting&&e.hasMoreData&&(console.log("Наблюдатель сработал! Загружаем новую страницу..."),x())},{rootMargin:"100px",threshold:.1}),l.observe(i.value))};return b(()=>{e.stocksArray=[],e.hasMoreData=!0}),S(async()=>{e.stocksArray.length===0&&await x(!0),M(()=>h())}),P(()=>k.language,()=>{e.loadAllStocks({page:a.value,limit:e.itemPerPage})}),(o,r)=>(n(),c("div",L,[u("div",null,[v(T,{name:"fade",tag:"div",class:"grid grid-cols-4 max-xl:grid-cols-3 max-lg:grid-cols-2 max-md:grid-cols-1 max-md:px-10 max-sm:px-4 gap-y-10 gap-x-4 w-full",ref_key:"el",ref:y},{default:d(()=>[(n(!0),c(D,null,I(p(e).stocksArray,(s,g)=>(n(),c("div",{key:s==null?void 0:s.id,style:B({transitionDelay:g*.1+"s"})},[v(z,{"card-block-style":"hover:scale-105 rounded-[8px] w-full h-full shadow-lg transition-all duration-200","card-image-style":"rounded-[8px] ","card-title-style":"px-4 py-3","card-link-text":"stocks","card-image-flag":!0,"card-title-flag":!0,"card-description-flag":!0,"card-price-flag":!1,"card-link":s==null?void 0:s.id},{cardImage:d(()=>[u("img",{class:"rounded-[8px] w-full mx-auto",src:p(E)+(s==null?void 0:s.poster_url),alt:""},null,8,O)]),cardTitle:d(()=>[N(V(p(k).language!=="ru"?s==null?void 0:s.title_uz:s==null?void 0:s.title),1)]),_:2},1032,["card-link"])],4))),128))]),_:1},512)]),u("div",{ref_key:"observerTarget",ref:i,class:"h-10"},null,512),t.value?(n(),c("div",U,r[0]||(r[0]=[u("p",null,"Загрузка...",-1)]))):A("",!0)]))}});export{K as default};
