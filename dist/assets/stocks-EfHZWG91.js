import{b as _,A as w,f,B as b,C as S,D as A,q as D,o as n,c,a as i,h as m,w as d,T as M,i as P,F as T,l as I,E as B,k as x,y as N,t as U}from"./index-CHCyrYkC.js";import{u as V}from"./stocks-DLiu6TFX.js";import{_ as E}from"./card.vue_vue_type_script_setup_true_lang-C7y8YrLl.js";import{g as F}from"./hooks-CHDj8uky.js";import{u as G}from"./global-DwZMPApQ.js";import"./axios-rFEYxPUp.js";const L={class:"container mx-auto"},O=["src"],$={key:0,class:"text-center mt-4"},Q=_({__name:"stocks",setup(q){const v=w("el"),t=f(1),l=f(!1),u=f(null),p=G(),e=V(),k=async(a=!1)=>{if(l.value||!e.hasMoreData)return;l.value=!0;let r=a?1:t.value+1;console.log(`Загрузка страницы: ${r}`);try{await e.loadAllStocks({page:t.value,limit:e.itemPerPage,local:p.language.toUpperCase()}),e.stocks.length>0?(e.stocks.filter(g=>!e.stocksArray.some(h=>h.id===g.id)).length>0&&(e.stocksArray.push(...e.stocks),t.value++),e.stocks.length<e.itemPerPage&&(console.log("Меньше товаров, чем лимит, останавливаем дальнейшую загрузку."),e.hasMoreData=!1)):e.hasMoreData=!1}catch(s){console.error("Ошибка при загрузке скидок:",s)}finally{l.value=!1}};let o=null;const y=()=>{o&&o.disconnect(),u.value&&(o=new IntersectionObserver(a=>{a[0].isIntersecting&&e.hasMoreData&&(console.log("Наблюдатель сработал! Загружаем новую страницу..."),k())},{rootMargin:"100px",threshold:.1}),o.observe(u.value))};return b(()=>{e.stocksArray=[],e.hasMoreData=!0}),S(async()=>{e.stocksArray.length===0&&await k(!0),A(()=>y())}),D(()=>p.language,a=>{e.loadAllStocks({page:t.value,limit:e.itemPerPage,local:a.toUpperCase()})}),(a,r)=>(n(),c("div",L,[i("div",null,[m(M,{name:"fade",tag:"div",class:"grid grid-cols-4 max-xl:grid-cols-3 max-lg:grid-cols-2 max-md:grid-cols-1 max-md:px-10 max-sm:px-4 gap-y-10 gap-x-4 w-full",ref_key:"el",ref:v},{default:d(()=>[(n(!0),c(T,null,I(x(e).stocksArray,(s,g)=>(n(),c("div",{key:s==null?void 0:s.id,style:B({transitionDelay:g*.1+"s"})},[m(E,{"card-block-style":"hover:scale-105 rounded-[8px] w-full h-full shadow-lg transition-all duration-200","card-image-style":"rounded-[8px] ","card-title-style":"px-4 py-3","card-link-text":"stocks","card-image-flag":!0,"card-title-flag":!0,"card-description-flag":!0,"card-price-flag":!1,"card-link":s==null?void 0:s.id},{cardImage:d(()=>[i("img",{class:"rounded-[8px] w-full mx-auto",src:x(F)+(s==null?void 0:s.poster_url),alt:""},null,8,O)]),cardTitle:d(()=>[N(U(s==null?void 0:s.title),1)]),_:2},1032,["card-link"])],4))),128))]),_:1},512)]),i("div",{ref_key:"observerTarget",ref:u,class:"h-10"},null,512),l.value?(n(),c("div",$,r[0]||(r[0]=[i("p",null,"Загрузка...",-1)]))):P("",!0)]))}});export{Q as default};
