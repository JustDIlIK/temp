import{b as M,y as S,f as p,A as P,B,o as u,c as x,a as n,h as y,w as c,T as I,i as k,m as h,t as _,F as L,q as F,x as C,u as T,C as N}from"./index-CaBtS6-l.js";/* empty css             */import{T as H}from"./TheTitle-w-SCR3HF.js";import{_ as V}from"./card.vue_vue_type_script_setup_true_lang-I6ZNas0m.js";import{u as $}from"./products-BwEdvEtn.js";import{g as E}from"./hooks-CHDj8uky.js";import"./axios-rFEYxPUp.js";const j={class:"container mx-auto"},q={class:"max-md:mx-4"},z=["src"],O=["innerHTML"],A={class:"price-container relative"},G=["innerHTML"],R={key:0,class:"price-strike absolute -bottom-1.5 -left-1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 20",width:"110%",height:"40"},U={key:0,class:"text-center mt-4"},re=M({__name:"discounts",setup(W){const l=$(),m=S("el"),b=p(4),w=p(1),d=p(!1),f=p(null),g=s=>{if(!s)return"";let a=s.toLocaleString();const e=a.replace(/0+$/,"");let o=e;if(e.length<a.length){const t=a.slice(e.length);t.length===3?o+=t.replace(/0/g,r=>`<sup>${r}</sup>`):o+=t}return o},v=async(s=!1)=>{if(d.value||!l.hasMoreData)return;d.value=!0;let a=s?1:w.value+1;try{for(;;){if(await l.loadProducts({page:a,limit:b.value}),l.products.length===0){l.hasMoreData=!1;break}const e=l.products.flatMap(()=>l.products.map(r=>r?{...r}:null)).filter(Boolean),o=new Set(l.newData.map(r=>r.id)),t=e.filter(r=>o.has(r.id)?!1:(o.add(r.id),!0));if(t.length&&(l.newData.push(...t),w.value=a),t.length<b.value)break;a++}}catch(e){console.error(e)}finally{d.value=!1}};let i=null;const D=()=>{i&&i.disconnect(),f.value&&(i=new IntersectionObserver(s=>{s[0].isIntersecting&&l.hasMoreData&&!d.value&&v()},{rootMargin:"100px",threshold:.1}),i.observe(f.value))};return P(async()=>{await v(!0),B(()=>D())}),(s,a)=>(u(),x("div",j,[n("div",q,[y(H,null,{default:c(()=>[h(_(s.$t("Каталог скидок")),1)]),_:1})]),n("div",{ref_key:"el",ref:m},[y(I,{name:"fade",tag:"div",class:"grid grid-cols-4 max-2xl:grid-cols-3 max-xl:grid-cols-2 max-md:grid-cols-1 max-xl:mx-auto justify-center items-center gap-x-10 break-all"},{default:c(()=>[(u(!0),x(L,null,F(T(l).newData,(e,o)=>(u(),C(V,{key:e.id,style:N({transitionDelay:o*.07+"s"}),"card-image-flag":!0,"card-percent-flag":!0,"price-container-flag":!0,"card-description-flag":!0,"card-title-flag":!0,"card-discount-flag":!0,"card-price-flag":!0,"card-block-style":"w-[358px] overflow-hidden h-[400px] max-xl:w-full max-md:w-11/12 max-md:mx-4 flex flex-col justify-center items-center mx-2 bg-white shadow-blockShadow p-7 mb-10 mt-10 rounded-xl","card-link-text":"product","card-price-design-container":e.discount!==null?"absolute top-40 -right-10 text-white":"absolute text-white bottom-0 right-0","card-price-design":e.discount!==null?"relative text-center bg-[#FE5000] h-[90px] rounded-tl-[40%] rounded-tr-xl rounded-br-full !rounded-b-2xl pl-4 [clip-path:polygon(25%_0%,100%_0,100%_70%,60%_100%,0_100%,0_40%)]":"relative text-center bg-[#FE5000] h-[35px] w-[150px]","card-discount-style":"text-[28px] pt-[24px] font-obold pr-[10px]","card-price-style":e.discount!==null?"text-[15px] font-oregular flex":"text-[21px] font-oregular flex mx-auto","card-price-and-percent":e.discount!==null?"flex gap-x-2 items-center pl-4 absolute bottom-0 right-0 w-full":"absolute flex gap-x-2 items-center bottom-0 right-0 w-full","card-percent-style":"text-[14px] font-obold text-black bg-[#FFC600] py-3 px-1 rounded-tl-xl rounded-br-[20px] rounded-bl-md rounded-tr-md -right-1 absolute [clip-path:polygon(33%_0,100%_0,100%_70%,68%_100%,0_100%,0%_39%)]","card-title-style":"text-[22px] mt-10 !font-omedium","card-image-style":"mx-auto relative w-[224px] h-[224px] rounded-full","card-link":e==null?void 0:e.id},{cardImage:c(()=>[n("img",{class:"rounded-lg w-full",src:T(E)+(e==null?void 0:e.image_url),alt:""},null,8,z)]),cardTitle:c(()=>{var t,r;return[h(_(((t=e==null?void 0:e.title)==null?void 0:t.length)>40?((r=e==null?void 0:e.title)==null?void 0:r.slice(0,40))+"...":e==null?void 0:e.title),1)]}),cardDescription:c(()=>{var t,r;return[h(_(((t=e==null?void 0:e.description)==null?void 0:t.length)>40?((r=e==null?void 0:e.description)==null?void 0:r.slice(0,40))+"...":e==null?void 0:e.description),1)]}),cardDiscount:c(()=>[n("span",{innerHTML:g(e==null?void 0:e.price)},null,8,O)]),cardPrice:c(()=>[n("div",A,[n("span",{class:"price-text",innerHTML:e.discount_type!=="percent"?g((e==null?void 0:e.price)+e.discount):g(e==null?void 0:e.originalPrice)},null,8,G),e.discount!==null?(u(),x("svg",R,a[0]||(a[0]=[n("line",{x1:"100",y1:"0",x2:"0",y2:"25",stroke:"white","stroke-width":"2"},null,-1)]))):k("",!0)])]),_:2},1032,["style","card-price-design-container","card-price-design","card-price-style","card-price-and-percent","card-link"]))),128))]),_:1})],512),n("div",{ref_key:"observerTarget",ref:f,class:"h-10"},null,512),d.value?(u(),x("div",U,a[1]||(a[1]=[n("p",null,"Загрузка...",-1)]))):k("",!0)]))}});export{re as default};
