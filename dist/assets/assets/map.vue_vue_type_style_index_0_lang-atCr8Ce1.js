import{u as y}from"./map-Cf6aGZsW.js";import{b as h,f as p,p as b,B as g,G as k,o as u,c as i,i as w}from"./index-Cj4oQsIH.js";const C={key:0},x=h({__name:"map",setup($){const c=y(),r=p(!1),a=p(null);let l=null;const v=()=>{if(document.getElementById("yandex-maps-script"))return;const e=document.createElement("script");e.id="yandex-maps-script",e.src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=fc906a8f-366e-48a2-8be7-17e554ed7bd2",e.async=!0,e.onload=()=>{r.value=!0,f()},document.body.appendChild(e)},f=async()=>{await c.loadAllShop(),ymaps.ready(()=>{var t;l=new ymaps.Map(a.value,{center:[41.3114,69.280226],zoom:12,controls:["zoomControl","trafficControl","rulerControl"]});const e=new ymaps.GeoObjectCollection(null,{preset:"islands#dotIcon",iconColor:"#FE5000"}),o=(t=c.shop)==null?void 0:t.map(n=>({coords:[n.longitude,n.latitude],id:n.id,address:n.address,title:n.title,landmark:n.landmark,close_at:n.close_at,open_at:n.open_at}));o==null||o.forEach(n=>{let s=new ymaps.Placemark(n.coords,{},{preset:"islands#dotIcon"});s.id=n.id,s.events.add("click",()=>{_({coords:n==null?void 0:n.coords,address:n==null?void 0:n.address,title:n==null?void 0:n.title,close_at:n==null?void 0:n.close_at,open_at:n==null?void 0:n.open_at,landmark:n==null?void 0:n.landmark})}),e.add(s)}),l.geoObjects.add(e)})},_=e=>{const o=`
     <div>
      <div class="custom-container">
        <h3>${e.title}</h3>
        <p><strong>Адрес:</strong> ${e.address}</p>
        <p><strong>Режим работы:</strong> ${e.open_at} - ${e.close_at}</p>
        <p><strong>Ориентир:</strong> ${e.landmark}</p>
      </div>
      <button id="open-in-new" class="custom-btn">Перейти</button>
    </div>
  `;console.log(e),l.balloon.open(e.coords,o);const t=document.getElementById("open-in-new");t&&t.addEventListener("click",()=>{}),setTimeout(()=>{const n=document.getElementById("open-in-new");n&&n.addEventListener("click",s=>{s.stopPropagation(),m(e.coords)})},100)},m=e=>{const o=`https://yandex.ru/maps/?ll=${e[1]},${e[0]}&mode=search&pt=${e[1]},${e[0]}&sll=${e[1]},${e[0]}&text=${e[0]},${e[1]}&z=16.04`;window.open(o,"_blank")},d=new IntersectionObserver(e=>{e[0].isIntersecting&&!r.value&&(v(),d.disconnect())},{threshold:.1});return b(()=>c.center,e=>{l.setCenter(e,16,{checkZoomRange:!0})}),g(()=>{if(a.value)d.observe(a.value);else{const e=setInterval(()=>{a.value&&(d.observe(a.value),clearInterval(e))},100)}}),k(()=>{r.value=!1;const e=document.getElementById("yandex-maps-script");e&&document.body.removeChild(e)}),(e,o)=>(u(),i("div",{ref_key:"mapContainer",ref:a,id:"map-placeholder"},[r.value?w("",!0):(u(),i("span",C,"Карта загружается..."))],512))}});export{x as _};
