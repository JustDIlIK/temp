import{u as b}from"./map-CLO9lwNA.js";import{b as h,g as _,D as z,x as $,H as w,J as m,o as v,c as f,k as C}from"./index-CE6KkOkP.js";import{u as I}from"./global-BsgjTX97.js";const E={key:0},M=h({__name:"map",setup(x){const c=b(),r=_(!1),o=_(null),{t:l}=z(),u=I();let d=null;const g=()=>{if(document.getElementById("yandex-maps-script"))return;const e=document.createElement("script");e.id="yandex-maps-script",e.src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=fc906a8f-366e-48a2-8be7-17e554ed7bd2",e.async=!0,e.onload=()=>{r.value=!0,i()},document.body.appendChild(e)},i=async()=>{await c.loadAllShop(),ymaps.ready(()=>{var s;d=new ymaps.Map(o.value,{center:[41.3114,69.280226],zoom:12,controls:["zoomControl","trafficControl","rulerControl"]});const e=new ymaps.GeoObjectCollection(null,{preset:"islands#dotIcon",iconColor:"#FE5000"}),a=(s=c.shop)==null?void 0:s.map(n=>({coords:[n.longitude,n.latitude],id:n.id,address:n.address,address_uz:n.address_uz,title:n.title,title_uz:n.title_uz,landmark_uz:n.landmark_uz,landmark:n.landmark,close_at:n.close_at,open_at:n.open_at}));a==null||a.forEach(n=>{let t=new ymaps.Placemark(n.coords,{},{preset:"islands#dotIcon"});t.id=n.id,t.events.add("click",()=>{k({coords:n==null?void 0:n.coords,address:n==null?void 0:n.address,address_uz:n==null?void 0:n.address_uz,title_uz:n==null?void 0:n.title_uz,title:n==null?void 0:n.title,close_at:n==null?void 0:n.close_at,open_at:n==null?void 0:n.open_at,landmark:n==null?void 0:n.landmark,landmark_uz:n==null?void 0:n.landmark_uz})}),e.add(t)}),d.geoObjects.add(e)})},k=e=>{const a=`
     <div>
      <div class="custom-container">
        <h3>${e.title}</h3>
        <p><strong>${l("Адрес")}:</strong> ${u.language!=="ru"?e.address_uz:e.address}</p>
        <p><strong>${l("Режим работы")}:</strong> ${e.open_at} - ${e.close_at}</p>
        <p><strong>${l("Ориентир")}:</strong> ${u.language!=="ru"?e.landmark_uz:e.landmark}</p>
      </div>
      <button id="open-in-new" class="custom-btn">${l("Перейти")}</button>
    </div>
  `;console.log(e),d.balloon.open(e.coords,a);const s=document.getElementById("open-in-new");s&&s.addEventListener("click",()=>{}),setTimeout(()=>{const n=document.getElementById("open-in-new");n&&n.addEventListener("click",t=>{t.stopPropagation(),y(e.coords)})},100)},y=e=>{const a=`https://yandex.ru/maps/?ll=${e[1]},${e[0]}&mode=search&pt=${e[1]},${e[0]}&sll=${e[1]},${e[0]}&text=${e[0]},${e[1]}&z=16.04`;window.open(a,"_blank")},p=new IntersectionObserver(e=>{e[0].isIntersecting&&!r.value&&(g(),p.disconnect())},{threshold:.1});return $(()=>c.center,e=>{d.setCenter(e,16,{checkZoomRange:!0})}),w(()=>{if(o.value)p.observe(o.value);else{const e=setInterval(()=>{o.value&&(p.observe(o.value),clearInterval(e))},100)}}),m(()=>{r.value=!1;const e=document.getElementById("yandex-maps-script");e&&document.body.removeChild(e)}),(e,a)=>(v(),f("div",{ref_key:"mapContainer",ref:o,id:"map-placeholder"},[r.value?C("",!0):(v(),f("span",E,"Карта загружается..."))],512))}});export{M as _};
