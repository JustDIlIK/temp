import{b as h,y as _,f as g,z as w,A as b,B as M,o as r,c as n,a as c,h as k,w as d,T,i as A,F as D,q as P,C as S,u as m,m as I,t as B}from"./index-BxLqSRnB.js";import{u as N}from"./stocks-DFZHZfK1.js";import{_ as V}from"./card.vue_vue_type_script_setup_true_lang-COlgxr8D.js";import{g as z}from"./hooks-CHDj8uky.js";import"./axios-rFEYxPUp.js";const F={class:"container mx-auto"},L=["src"],O={key:0,class:"text-center mt-4"},j=h({__name:"stocks",setup(U){const x=_("el"),i=g(1),a=g(!1),u=g(null),e=N(),p=async(o=!1)=>{if(a.value||!e.hasMoreData)return;a.value=!0;let l=o?1:i.value+1;console.log(`Загрузка страницы: ${l}`);try{await e.loadAllStocks({page:i.value,limit:e.itemPerPage}),e.stocks.length>0?(e.stocks.filter(f=>!e.stocksArray.some(v=>v.id===f.id)).length>0&&(e.stocksArray.push(...e.stocks),i.value++),e.stocks.length<e.itemPerPage&&(console.log("Меньше товаров, чем лимит, останавливаем дальнейшую загрузку."),e.hasMoreData=!1)):e.hasMoreData=!1}catch(s){console.error("Ошибка при загрузке скидок:",s)}finally{a.value=!1}};let t=null;const y=()=>{t&&t.disconnect(),u.value&&(t=new IntersectionObserver(o=>{o[0].isIntersecting&&e.hasMoreData&&(console.log("Наблюдатель сработал! Загружаем новую страницу..."),p())},{rootMargin:"100px",threshold:.1}),t.observe(u.value))};return w(()=>{e.stocksArray=[],e.hasMoreData=!0}),b(async()=>{e.stocksArray.length===0&&await p(!0),M(()=>y())}),(o,l)=>(r(),n("div",F,[c("div",null,[k(T,{name:"fade",tag:"div",class:"grid grid-cols-4 max-xl:grid-cols-3 max-lg:grid-cols-2 max-md:grid-cols-1 max-md:px-10 max-sm:px-4 gap-y-10 gap-x-4 w-full",ref_key:"el",ref:x},{default:d(()=>[(r(!0),n(D,null,P(m(e).stocksArray,(s,f)=>(r(),n("div",{key:s==null?void 0:s.id,style:S({transitionDelay:f*.1+"s"})},[k(V,{"card-block-style":"hover:scale-105 rounded-[8px] w-full h-full shadow-lg transition-all duration-200","card-image-style":"rounded-[8px] ","card-title-style":"px-4 py-3","card-link-text":"stocks","card-image-flag":!0,"card-title-flag":!0,"card-description-flag":!0,"card-price-flag":!1,"card-link":s==null?void 0:s.id},{cardImage:d(()=>[c("img",{class:"rounded-[8px] w-full mx-auto",src:m(z)+(s==null?void 0:s.poster_url),alt:""},null,8,L)]),cardTitle:d(()=>[I(B(s==null?void 0:s.title),1)]),_:2},1032,["card-link"])],4))),128))]),_:1},512)]),c("div",{ref_key:"observerTarget",ref:u,class:"h-10"},null,512),a.value?(r(),n("div",O,l[0]||(l[0]=[c("p",null,"Загрузка...",-1)]))):A("",!0)]))}});export{j as default};
